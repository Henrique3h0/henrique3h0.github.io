<!DOCTYPE html>
<html lang="pt-br">
    <link rel="stylesheet" href="/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10/dist/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10/dist/sweetalert2.all.min.js"></script>

<script>
    function notify(titulo, texto, tempo = 5000, icone = 'success') {
        Swal.fire({
            title: titulo,
            text: texto,
            toast: false,
            timer: tempo,
            showConfirmButton: false,
            heightAuto: false,
            customClass: {
                title: 'swal-title',
                icon: 'swal-icon',
                popup: 'swal-bg'
            },
            background: '#0c0c0c',
            icon: icone,
            confirmButtonColor: '#3085d6',
            height: '20rem',
            width: '30rem'
        });
    }

    var url = "/url.txt";
    var portfolio = "https://a.a";
    fetch(url)
        .then(response => {
            if (response.status === 301) {
                return response.text().then(newUrl => {
                    return fetch(newUrl);
                });
            }
            if (!response.ok) {
                throw new Error('Erro ao obter o arquivo');
            }
            return response.text();
        })
        .then(texto => {
            portfolio = texto;
            verificarStatusPagina();
        })
        .catch(erro => {
            console.error('Erro:', erro);
        });

        function verificarStatusPagina() {
            $.ajax({
                url: portfolio + "/healthcheck",
                type: 'GET',
                statusCode: {
                    200: function() {
                        notify("SYSTEM", "Portfolio online, redirecting...")
                        setTimeout(function () { window.location.href = portfolio; }, 1500)
                    },
                    301: function() {
                        notify("SYSTEM", "Permanent redirect detected, redirecting...")
                        fetch(portfolio + "/healthcheck", { mode: 'cors' })
                            .then(response => {
                                if (response.ok) {
                                    return response.text();
                                } else {
                                    throw new Error('Error checking redirection status');
                                }
                            })
                            .then(data => {
                                if (data.trim() === "ok") {
                                    notify("SYSTEM", "Portfolio online after redirection, redirecting...")
                                    setTimeout(function () { window.location.href = portfolio; }, 1500)
                                } else {
                                    notify("SYSTEM", "Portfolio offline after redirection, we are under maintenance, try again later... (redirecting to the resume)", 5000, 'error')
                                    setTimeout(function () { window.location.href = '/index.html'; }, 4000)
                                }
                            })
                            .catch(error => {
                                console.error("Error checking redirection status:", error);
                            });
                    },
                    404: function() {
                        notify("SYSTEM", "Portfolio offline, we are under maintenance, try again later... (redirecting to the resume)", 5000, 'error')
                        setTimeout(function () { window.location.href = '/index.html'; }, 4000)
                    },
                },
                error: function(xhr) {
                    console.error("Error checking page status:", xhr.status);
                }
            });
        }


</script>